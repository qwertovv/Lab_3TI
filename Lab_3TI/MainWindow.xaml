<Window x:Class="LoopInvariantChecker.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Проверка корректности циклов" Height="650" Width="900">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Данные -->
        <GroupBox Grid.Row="0" Header="Данные" Margin="0,0,0,10">
            <StackPanel>
                <StackPanel Orientation="Horizontal" Margin="5">
                    <TextBlock Text="Размер массива:" Width="100"/>
                    <TextBox x:Name="ArraySizeBox" Text="10" Width="50" Margin="5,0"/>
                    <TextBlock Text="Min:" Width="40" Margin="20,0,0,0"/>
                    <TextBox x:Name="MinValueBox" Text="0" Width="50" Margin="5,0"/>
                    <TextBlock Text="Max:" Width="40" Margin="20,0,0,0"/>
                    <TextBox x:Name="MaxValueBox" Text="100" Width="50" Margin="5,0"/>
                    <TextBlock Text="Порог T:" Width="60" Margin="20,0,0,0"/>
                    <TextBox x:Name="ThresholdBox" Text="50" Width="50" Margin="5,0"/>
                    <Button x:Name="GenerateButton" Content="Сгенерировать" Margin="20,0" Click="GenerateButton_Click"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="5">
                    <TextBlock Text="Режим:" Width="100"/>
                    <ComboBox x:Name="ModeComboBox" Width="150" Margin="5,0" SelectionChanged="ModeComboBox_SelectionChanged">
                        <ComboBoxItem Content="Prefix Sum"/>
                        <ComboBoxItem Content="Count > T"/>
                        <ComboBoxItem Content="Prefix Max"/>
                    </ComboBox>
                    <Button x:Name="InitButton" Content="Инициализировать цикл" Margin="20,0" Click="InitButton_Click"/>
                </StackPanel>

                <ListBox x:Name="ArrayListBox" Height="80" Margin="5"/>
            </StackPanel>
        </GroupBox>

        <!-- Исполнение и мониторинг -->
        <GroupBox Grid.Row="1" Header="Исполнение и мониторинг" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="2*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Margin="5">
                    <TextBlock Text="Текущее состояние:" FontWeight="Bold"/>
                    <TextBlock x:Name="JText" Text="j = 0" Margin="0,5"/>
                    <TextBlock x:Name="ResText" Text="res = 0" Margin="0,5"/>
                    <TextBlock x:Name="VariantText" Text="Вариант-функция: 0" Margin="0,5"/>

                    <!-- Блок для отображения найденных элементов -->
                    <StackPanel x:Name="FoundElementsPanel" Margin="0,10" Visibility="Collapsed">
                        <TextBlock Text="Найденные элементы > T:" FontWeight="Bold" Margin="0,0,0,5"/>
                        <ListBox x:Name="FoundElementsList" Height="60" BorderThickness="1"/>
                    </StackPanel>

                    <ProgressBar x:Name="VariantProgress" Height="20" Margin="0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <Button x:Name="StepButton" Content="Шаг" Margin="0,0,5,0" Click="StepButton_Click"/>
                        <Button x:Name="StartButton" Content="Пуск" Margin="5,0" Click="StartButton_Click"/>
                        <Button x:Name="StopButton" Content="Стоп" Margin="5,0" Click="StopButton_Click"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,10">
                        <TextBlock Text="Инвариант до:" Margin="0,0,10,0"/>
                        <Ellipse x:Name="InvBeforeCircle" Width="15" Height="15" Fill="Gray"/>
                        <TextBlock Text="Инвариант после:" Margin="20,0,10,0"/>
                        <Ellipse x:Name="InvAfterCircle" Width="15" Height="15" Fill="Gray"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Column="1" Margin="10">
                    <GroupBox Header="Инвариант">
                        <StackPanel Margin="5">
                            <TextBlock x:Name="InvVerbalText" FontWeight="Bold"/>
                            <TextBlock x:Name="InvFormulaText" Margin="0,5" FontStyle="Italic"/>
                        </StackPanel>
                    </GroupBox>

                    <GroupBox Header="Проверка сохранения (wp)" Margin="0,10,0,0">
                        <StackPanel Margin="5">
                            <TextBlock x:Name="WpFormulaText" FontStyle="Italic"/>
                            <TextBlock x:Name="WpVerbalText" Margin="0,5"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Блок логов с кнопкой экспорта -->
                    <GroupBox Header="Логи" Margin="0,10,0,0">
                        <StackPanel>
                            <Button x:Name="ExportLogsButton" 
                                    Content="Экспорт логов" 
                                    Width="100" 
                                    HorizontalAlignment="Right" 
                                    Margin="5,5,5,0"
                                    Click="ExportLogsButton_Click"
                                    ToolTip="Сохранить логи в текстовый файл"
                                    Background="#E6F3FF"
                                    BorderBrush="#0078D4"/>
                            <ListBox x:Name="LogListBox" Height="130"/>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </Grid>
        </GroupBox>

        <StatusBar Grid.Row="2">
            <StatusBarItem>
                <TextBlock x:Name="StatusModeText"/>
            </StatusBarItem>
            <StatusBarItem>
                <TextBlock x:Name="StatusCompletedText"/>
            </StatusBarItem>
        </StatusBar>

        <!-- Кнопка справки в правом нижнем углу всего окна -->
        <Button x:Name="HelpButton" 
                Grid.RowSpan="3"
                Content="?" 
                Width="35" 
                Height="35" 
                FontSize="16" 
                FontWeight="Bold"
                HorizontalAlignment="Right" 
                VerticalAlignment="Bottom" 
                Margin="0,0,20,20"
                Click="HelpButton_Click"
                ToolTip="Справка по использованию приложения"
                Background="#0078D4" 
                Foreground="White"
                BorderThickness="0"
                Panel.ZIndex="1000">
            <Button.Style>
                <Style TargetType="Button">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" 
                                        CornerRadius="17.5"
                                        BorderThickness="0">
                                    <ContentPresenter HorizontalAlignment="Center" 
                                                    VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Button.Style>
        </Button>
    </Grid>
</Window>